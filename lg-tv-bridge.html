<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LG TV Bridge Server</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a2e;
            color: #00ff00;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .log {
            background: #0f0f23;
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #00ff00;
            padding-left: 10px;
        }

        .error {
            border-left-color: #ff0000;
            color: #ff6b6b;
        }

        .success {
            border-left-color: #51cf66;
            color: #51cf66;
        }

        .info {
            border-left-color: #4facfe;
            color: #4facfe;
        }

        h1 {
            color: #00ff00;
            text-align: center;
        }

        .status {
            text-align: center;
            font-size: 18px;
            margin: 20px 0;
        }

        .config {
            background: #0f0f23;
            border: 1px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        input {
            background: #1a1a2e;
            border: 1px solid #667eea;
            color: #00ff00;
            padding: 8px;
            border-radius: 4px;
            width: 200px;
            font-family: inherit;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #764ba2;
        }
    </style>
</head>

<body>
    <h1>ğŸŒ‰ LG TV Bridge Server</h1>

    <div class="status">
        <span id="status">â¸ï¸ HazÄ±r</span>
    </div>

    <div class="config">
        <h3>TV YapÄ±landÄ±rmasÄ±</h3>
        <label>TV IP: <input type="text" id="tvIP" value="192.168.1.35" placeholder="192.168.1.35"></label><br><br>
        <button onclick="startBridge()">ğŸš€ Bridge'i BaÅŸlat</button>
        <button onclick="testConnection()">ğŸ” BaÄŸlantÄ±yÄ± Test Et</button>
        <button onclick="clearLog()">ğŸ—‘ï¸ GÃ¼nlÃ¼ÄŸÃ¼ Temizle</button>
    </div>

    <div class="log" id="log">
        <div class="log-entry info">Bridge server hazÄ±r. TV IP adresini girin ve baÅŸlatÄ±n.</div>
    </div>

    <script>
        let tvIP = '192.168.1.35';
        let bridgeActive = false;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            log('GÃ¼nlÃ¼k temizlendi', 'info');
        }

        async function testConnection() {
            tvIP = document.getElementById('tvIP').value;
            log(`TV baÄŸlantÄ±sÄ± test ediliyor: ${tvIP}`, 'info');

            // Test different ports
            const ports = [8080, 3000, 3001, 8001];

            for (const port of ports) {
                try {
                    log(`Port ${port} deneniyor...`, 'info');
                    const response = await fetch(`http://${tvIP}:${port}/`, {
                        method: 'GET',
                        mode: 'no-cors'
                    });
                    log(`âœ“ Port ${port} yanÄ±t verdi`, 'success');
                } catch (error) {
                    log(`âœ— Port ${port} yanÄ±t vermedi: ${error.message}`, 'error');
                }
            }

            log('BaÄŸlantÄ± testi tamamlandÄ±', 'info');
        }

        function startBridge() {
            tvIP = document.getElementById('tvIP').value;
            bridgeActive = true;
            document.getElementById('status').textContent = 'ğŸŸ¢ Aktif';
            log(`Bridge baÅŸlatÄ±ldÄ± - TV IP: ${tvIP}`, 'success');
            log('Kumanda uygulamasÄ±ndan gelen komutlar burada gÃ¶rÃ¼necek', 'info');

            // Listen for messages from the remote control
            window.addEventListener('message', handleRemoteCommand);
        }

        function handleRemoteCommand(event) {
            if (!bridgeActive) return;

            const { command, key } = event.data;
            log(`Komut alÄ±ndÄ±: ${key}`, 'info');

            // Send command to TV
            sendToTV(command, key);
        }

        async function sendToTV(command, key) {
            try {
                log(`TV'ye gÃ¶nderiliyor: ${key}`, 'info');

                // UDAP protocol for older LG TVs
                const udapCommand = {
                    envelope: {
                        api: 'command',
                        type: 'keyboard',
                        name: 'HandleKeyInput',
                        value: key
                    }
                };

                const response = await fetch(`http://${tvIP}:8080/udap/api/command`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(udapCommand),
                    mode: 'no-cors'
                });

                log(`âœ“ Komut gÃ¶nderildi: ${key}`, 'success');
            } catch (error) {
                log(`âœ— Komut gÃ¶nderilemedi: ${error.message}`, 'error');
            }
        }

        // Auto-load saved IP
        window.addEventListener('load', () => {
            const savedIP = localStorage.getItem('tvIP');
            if (savedIP) {
                document.getElementById('tvIP').value = savedIP;
                tvIP = savedIP;
            }
        });

        // Save IP on change
        document.getElementById('tvIP').addEventListener('change', (e) => {
            localStorage.setItem('tvIP', e.target.value);
        });
    </script>
</body>

</html>